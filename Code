Function RSI(rng As Range, nDays As Integer) As Variant
    Dim dPrice() As Double
    Dim i As Integer, j As Integer
    Dim dGain As Double, dLoss As Double
    Dim dRS As Double, dRSI As Double
    
    ReDim dPrice(1 To rng.Rows.Count)
    
    For i = 1 To rng.Rows.Count
        dPrice(i) = rng.Cells(i, 1).Value
    Next i
    
    dGain = 0
    dLoss = 0
    
    For i = 2 To nDays
        If dPrice(i) > dPrice(i - 1) Then
            dGain = dGain + dPrice(i) - dPrice(i - 1)
        ElseIf dPrice(i) < dPrice(i - 1) Then
            dLoss = dLoss + dPrice(i - 1) - dPrice(i)
        End If
    Next i
    
    dRS = dGain / dLoss
    dRSI = 100 - (100 / (1 + dRS))
    
    For i = nDays + 1 To UBound(dPrice)
        dGain = 0
        dLoss = 0
        
        For j = i - nDays + 1 To i
            If dPrice(j) > dPrice(j - 1) Then
                dGain = dGain + dPrice(j) - dPrice(j - 1)
            ElseIf dPrice(j) < dPrice(j - 1) Then
                dLoss = dLoss + dPrice(j - 1) - dPrice(j)
            End If
        Next j
        
        dRS = dGain / dLoss
        dRSI = 100 - (100 / (1 + dRS))
    Next i
    
    RSI = dRSI
End Function
